# EG-DESK Project Documentation

## Directory Structure

```
eg-desk/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ api/                    # API endpoints
â”‚   â”‚   â”œâ”€â”€ chat/route.js      # Chat API with multi-model support
â”‚   â”‚   â””â”€â”€ sheets/route.js    # Google Sheets API integration
â”‚   â”œâ”€â”€ audio/                 # Audio processing
â”‚   â”‚   â””â”€â”€ types.ts          # Audio-related type definitions
â”‚   â”œâ”€â”€ components/           # React components
â”‚   â”‚   â”œâ”€â”€ Chat/            # Chat-related components
â”‚   â”‚   â”œâ”€â”€ Landing/         # Landing page components
â”‚   â”‚   â”œâ”€â”€ Layout/          # Layout components
â”‚   â”‚   â””â”€â”€ Sheet/           # Sheet-related components
â”‚   â”œâ”€â”€ hooks/               # Custom React hooks
â”‚   â”‚   â”œâ”€â”€ useAuth.ts      # Authentication hook
â”‚   â”‚   â”œâ”€â”€ useChat.ts      # Chat functionality
â”‚   â”‚   â”œâ”€â”€ useSheet.ts     # Sheet management
â”‚   â”‚   â””â”€â”€ useVoice.ts     # Voice control
â”‚   â”œâ”€â”€ store/              # State management
â”‚   â”‚   â”œâ”€â”€ types.ts        # Store type definitions
â”‚   â”‚   â””â”€â”€ voice.ts        # Voice state management
â”‚   â”œâ”€â”€ types/              # Global type definitions
â”‚   â”‚   â”œâ”€â”€ chat.ts         # Chat-related types
â”‚   â”‚   â””â”€â”€ sheet.ts        # Sheet-related types
â”‚   â””â”€â”€ utils/              # Utility functions
â”‚       â”œâ”€â”€ AudioPlayer.ts  # Audio playback
â”‚       â””â”€â”€ AudioRecorder.ts # Audio recording
â”œâ”€â”€ components/             # Shared components
â”‚   â””â”€â”€ Icons.tsx          # Icon components
â”œâ”€â”€ lib/                   # Library configurations
â”‚   â”œâ”€â”€ firebaseConfig.ts  # Firebase setup
â”‚   â””â”€â”€ utils.ts          # Utility functions
â””â”€â”€ public/                # Public assets
    â”œâ”€â”€ audio-playback-worklet.js  # Audio playback processor
    â””â”€â”€ audio-processor-worklet.js  # Audio recording processor
```

## Core Features

### Authentication System (âœ… Implemented)
- Firebase-based Google OAuth2.0
- Automatic token refresh
- Secure session management
- Google Drive/Sheets scope permissions

### Google Sheets Integration (âœ… Implemented)
- List user's sheets
- Sort by last opened/modified
- Real-time data access
- Sheet selection interface
- Thumbnail preview support

### Voice Control System (ðŸš§ Partially Implemented)
- 24kHz high-quality recording
- Real-time transcription (In Progress)
- WebSocket-based streaming (In Progress)
- Voice command processing (Pending)
- Audio feedback system (In Progress)

### Chat Interface (âœ… Implemented)
- Multi-model AI support:
  - OpenAI GPT-3.5
  - Google Gemini
  - Anthropic Claude
- Real-time message updates
- Voice message support (Partial)
- Context preservation
- Error handling

### Audio Processing (ðŸš§ Partially Implemented)
- WebAudio API integration
- Custom AudioWorklet processors
- Real-time PCM processing
- Int16 audio encoding/decoding
- Buffer management

### UI Components (âœ… Implemented)
- Responsive layout
- Real-time feedback
- Loading indicators
- Error displays
- Voice recording status
- Sheet preview
- Resizable chat interface

## Technical Implementation

### State Management (âœ… Implemented)
- React hooks for local state
- WebSocket state sync (Partial)
- Audio buffer management (Partial)

### Audio Pipeline (ðŸš§ In Progress)
Current Status:
- âœ… MediaStream capture
- âœ… AudioWorklet processing
- ðŸš§ WebSocket streaming (In Progress)
- ðŸš§ Real-time playback (In Progress)
- ðŸš§ Buffer synchronization (In Progress)

### API Integration (âœ… Implemented)
- Edge runtime support
- LangChain integration
- Google Drive API v3
- WebSocket protocol (Partial)
- Error handling

### Type System (âœ… Implemented)
- TypeScript interfaces
- Strict type checking
- Cross-module type sharing
- Audio type definitions
- State type definitions

## UI/UX Design

### Layout Structure (âœ… Implemented)
- **Header**
  - App logo and title
  - Navigation menu
  - Chat toggle button
  - Clean, minimal design for focus

- **Main Workspace**
  - Left: Sheet viewer/selector (expandable)
  - Right: Chat interface (resizable)
  - Responsive grid system
  - Adaptive layout for different screen sizes

### Interactive Elements (âœ… Implemented)
- **Voice Control Button**
  - Location: Bottom-right of chat
  - Visual feedback:
    - Idle: Blue outline
    - Recording: Red pulsing animation
    - Processing: Loading spinner
  - Accessibility: Clear aria-labels

- **Chat Messages**
  - User messages: Right-aligned, blue background
  - AI responses: Left-aligned, gray background
  - Timestamp and status indicators
  - Smooth auto-scroll behavior

- **Sheet Selection**
  - Grid/List view toggle
  - Thumbnail previews
  - Sort/filter options
  - Search functionality
  - Last accessed indicators

### Visual Feedback (âœ… Implemented)
- **Loading States**
  - Skeleton loaders for sheets
  - Progress indicators for voice
  - Typing indicators for AI
  - Smooth transitions

- **Error Handling**
  - Inline error messages
  - Toast notifications
  - Retry options
  - Clear error recovery paths

### Accessibility Features (âœ… Implemented)
- **Keyboard Navigation**
  - Full keyboard control
  - Focus management
  - Clear focus indicators
  - Shortcut keys

- **Screen Readers**
  - ARIA labels
  - Role annotations
  - State announcements
  - Alternative text

### Responsive Design (âœ… Implemented)
- **Breakpoints**
  - Mobile: < 640px
  - Tablet: 640px - 1024px
  - Desktop: > 1024px

- **Adaptations**
  - Mobile: Stack layout
  - Tablet: Slide-over chat
  - Desktop: Side-by-side

### Animation & Transitions (âœ… Implemented)
- **Microinteractions**
  - Button hover/active states
  - Selection highlights
  - Scroll animations
  - Focus transitions

- **State Changes**
  - Smooth chat resizing
  - Sheet transitions
  - Modal animations
  - Loading sequences

### Color System (âœ… Implemented)
- **Primary Colors**
  - Blue (#3B82F6): Actions, links
  - Red (#EF4444): Recording, errors
  - Gray (#6B7280): Text, borders

- **Semantic Colors**
  - Success: Green (#10B981)
  - Warning: Yellow (#F59E0B)
  - Info: Blue (#3B82F6)
  - Error: Red (#EF4444)

### Typography (âœ… Implemented)
- **Font Family**
  - Primary: Inter
  - Monospace: JetBrains Mono

- **Scale**
  - Headings: 24-48px
  - Body: 14-16px
  - Small text: 12px

### Component Library (âœ… Implemented)
- **Base Components**
  - Buttons (primary, secondary, icon)
  - Inputs (text, select, checkbox)
  - Cards (sheet preview, message)
  - Icons (system icons, status)

- **Composite Components**
  - Sheet viewer
  - Chat interface
  - Voice control (Partial)
  - Navigation

### User Flows (âœ… Implemented)
- **Authentication**
  1. Landing page
  2. Google sign-in
  3. Permission grant
  4. Workspace redirect

- **Sheet Interaction**
  1. Sheet selection
  2. View/edit mode
  3. Voice command (Partial)
  4. AI assistance

### Performance Optimization (âœ… Implemented)
- **Loading Strategy**
  - Progressive loading
  - Lazy image loading
  - Component code splitting
  - Cached responses

- **Interaction Optimization**
  - Debounced inputs
  - Throttled animations
  - Optimized re-renders
  - Virtual scrolling

## Known Issues and Limitations

### Voice Mode (ðŸš§ In Progress)
1. WebSocket connection stability
2. Real-time transcription accuracy
3. Voice command recognition
4. Audio feedback latency

### Future Improvements
1. Enhanced voice command processing
2. Better error recovery for voice mode
3. Offline support for basic features
4. Performance optimizations for audio processing
5. Extended voice command vocabulary 